#' check_jpeg_equality
#'
#' @param equality_table test
#' @param pixels test
#'
#' @export
check_jpeg_equality <- function(
  equality_table,
  pixels = seq(1, 2001, 10)
) {

  message("Removing non-jpeg files from equality table...")
  
  jpeg_equality_table <- equality_table[
    grepl("^(.*)+(\\.jpg|\\.jpeg)$", jpeg_equality_table[["dir_A"]], ignore.case = TRUE) &
      grepl("^(.*)+(\\.jpg|\\.jpeg)$", jpeg_equality_table[["dir_B"]], ignore.case = TRUE),
  ]
  
  message("Comparing individual files by pixel values...")
  
  pb <- utils::txtProgressBar(
    min = 0,
    max = nrow(jpeg_equality_table),
    style = 3
  )
  
  equal <- c()
  for (i in 1:nrow(jpeg_equality_table)) {
    A_pic <- jpeg_equality_table[["dir_A"]][i]
    B_pic <- jpeg_equality_table[["dir_B"]][i]
    A_pic_values = jpeg::readJPEG(A_pic, native = T)[pixels]
    B_pic_values = jpeg::readJPEG(B_pic, native = T)[pixels]
    equal[i] <- identical(A_pic_values, B_pic_values)
    
    utils::setTxtProgressBar(pb, i)
  }
  
  close(pb)
  
  message("Adding result of equality test to equality table...")
  
  jpeg_equality_table$pixel_equal <- equal
  
  return(jpeg_equality_table)
  
}



